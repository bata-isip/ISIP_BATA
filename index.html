<!DOCTYPE html>
<html lang="en">
<head>
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>ISIP BATA</title>

  <!-- Fonts (motivational font for certificate + Poppins for UI) -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="style.css">
  <link rel="manifest" href="manifest.json">
</head>
<body>
  <div id="app">
    <!-- Login/Register -->
<div id="authPage">
  <h1 class="brand">ISIP BATA</h1>

  <div id="loginForm" class="card">
    <h2>Login</h2>
    <input type="text" id="loginUsername" placeholder="Username" autocomplete="username">

    <!-- Updated password input with embedded eye icon -->
    <div class="password-wrapper">
      <input type="password" id="loginPassword" placeholder="Password" autocomplete="current-password">
      <button type="button" class="eye-btn" onclick="togglePassword()">üëÅÔ∏è</button>
    </div>

    <label class="remember"><input type="checkbox" id="rememberMe"> Remember Me</label>
    <button class="primary" onclick="login()">Login</button>
    <p class="switch">Don't have an account yet? <span onclick="showRegister()">Register</span></p>
  </div>

  <div id="registerForm" class="card hidden">
    <h2>Register</h2>
    <input type="text" id="regFullName" placeholder="Full Name">
    <input type="text" id="regUsername" placeholder="Username">
    <input type="password" id="regPassword" placeholder="Password">
    <button class="primary" onclick="register()">Register</button>
    <p class="switch">Already have an account? <span onclick="showLogin()">Login</span></p>
  </div>
</div>

    <!-- Home Page -->
    <div id="homePage" class="hidden page">
      <h1>Welcome, <span id="studentName"></span>!</h1>
      <p class="tagline">Your offline Filipino learning companion ‚Äî lessons, quizzes, folklore, and fun!</p>
      <div class="subjects">
        <button class="subject-btn math" onclick="openSubject('Math')">Math</button>
        <button class="subject-btn science" onclick="openSubject('Science')">Science</button>
        <button class="subject-btn english" onclick="openSubject('English Vocabulary')">English Vocabulary</button>
        <button class="subject-btn filipino" onclick="openSubject('Filipino Vocabulary')">Filipino Vocabulary</button>
        <button class="subject-btn history" onclick="openSubject('Philippine History')">Philippine History</button>
      </div>
      <div class="controls">
        <button onclick="openProfile()">üìä My Profile</button>
        <button onclick="logout()">Logout</button>
      </div>
    </div>

    <!-- Lesson/Quiz Page -->
    <div id="lessonPage" class="hidden page">
      <h2 id="lessonTitle"></h2>
      <div id="lessonContent" class="card"></div>
      <div id="quizContainer" class="card quiz"></div>

      <div id="folkloreContainer" class="card hidden">
        <h3>Folklore Story:</h3>
        <p id="folkloreText"></p>
      </div>
      <div class="controls">
        <button onclick="goHome()">Back</button>
      </div>
    </div>

    <!-- Profile Page -->
    <div id="profilePage" class="hidden page">
      <h2>Profile Dashboard</h2>
      <p><strong>Name:</strong> <span id="profileName"></span></p>
      <p><strong>Username:</strong> <span id="profileUsername"></span></p>
      <p><strong>Lessons Completed:</strong> <span id="profileLessons"></span></p>
      <p><strong>Average Score:</strong> <span id="profileScore"></span></p>
      <p><strong>Certificates:</strong></p>
      <ul id="certificatesList"></ul>
      <p><strong>Badges Earned:</strong></p>
      <ul id="badgesList"></ul>
      <div class="controls">
        <button onclick="goHome()">Back to Home</button>
      </div>
    </div>

    <!-- Certificate Page -->
    <div id="certificatePage" class="hidden page card certificate-card">
      <h2 class="congrats">Certificate of Completion</h2>
      <p class="sub">This certificate is proudly awarded to</p>
      <h3 id="certName" class="cert-name"></h3>
      <p class="sub">For successfully completing the lesson:</p>
      <h4 id="certLesson" class="cert-lesson"></h4>
      <p id="certBadge" class="cert-badge"></p>
      <div class="controls">
        <button class="primary" onclick="downloadCertificate()">Download Certificate (PNG)</button>
        <button onclick="goHome()">Back to Home</button>
      </div>
    </div>

    <!-- hidden canvas for rendering certificate PNG -->
    <canvas id="certCanvas" width="1200" height="850" class="hidden"></canvas>
  </div>

    <script src="script.js"></script>
  <script>
    // for offline support
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", function () {
        navigator.serviceWorker.register("service-worker.js")
          .then(reg => console.log("Service Worker registered!", reg))
          .catch(err => console.log("Service Worker failed:", err));
      });
    }

    // If user remembered earlier
    (function tryRemember() {
      const rem = localStorage.getItem("rememberedUser");
      if (rem) {
        const u = JSON.parse(localStorage.getItem("users") || "{}");
        if (u[rem]) {
          currentUser = rem;
          document.getElementById("authPage").classList.add("hidden");
          document.getElementById("homePage").classList.remove("hidden");
          document.getElementById("studentName").innerText = u[rem].fullName;
        }
      }
    })();
  </script>
</body>
</html>
